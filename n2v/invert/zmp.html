<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2D2D2D" />
  
  <title>n2v :: ZMP</title>
  

  <link rel="icon" type="image/png" sizes="32x32" href="../_static/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../_static/img/favicon-16x16.png">
  <link rel="index" title="Index" href="../genindex.html"/>

  <link rel="stylesheet" href="../_static/css/insegel.css"/>
  <link rel="stylesheet" href="../_static/css/custom.css"/>

  <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  

  <script src="https://email.tl.fortawesome.com/c/eJxNjUEOgyAQAF8jR7Kw6wIHDh7sP1Cw2mgxgmn6-3JsMqc5zEQfE8dkxOY1KKMUOI3ACFKRJpSW2AAp7ontYIaxI6i7XPJVwyeVfCQ550Os3jLrGSNOLgbdAy6s0PBk2TFNjEbsfq31LB0OnX407pJa5v2faRadwSW63mn5KuLyR9j2tgx3zecanl-55R_-jjPs"></script> 
</head>

<body>
  <div id="insegel-container">
    <header>
      <div id="logo-container">
          
          <a href="../index.html"><img src="../_static/logo_nameless_png.png"></a>
          
      </div>
      <div id="project-container">
        
        <h1>n2v Documentation</h1>
        
      </div>
    </header>

    <div id="content-container">

      <div id="main-content-container">
        <div id="main-content" role="main">
          
  <div class="section" id="zmp">
<h1>ZMP<a class="headerlink" href="#zmp" title="Permalink to this headline">¶</a></h1>
<p>The Zhao, Morrison, and Parr method works by updating self-consistently a potential
generated by the difference between the current density and the target density.</p>
<div class="math notranslate nohighlight">
\[v_c^i(r) = \lambda \int \frac{n_i(r') - n_{0}(r')}{|r-r'|} dr'\]</div>
<p>The lambda parameter is a Lagrange multiplier that when it goes to infinity, it allows the previous potential to become the exact Kohn-Sham Potential.
In practice we won’t be able to increase lambda arbitrarily but values like 25, 50 or 75 are commonly used.
An iterative approach also lets you perform an extrapolation technique iteratively.
In order to trigger this calculation, specify more than one lambda.
A reliable option to choose is to begin with lambda=10 and make enough iterations to achieve desired convergence in density.</p>
<p>The full method’s description can be found:
From electron densities to Kohn-Sham kinetic energies, orbital energies, exchange-correlation potentials, and exchange-correlation energies
Qingsheng Zhao, Robert C. Morrison, and Robert G. Parr
Phys. Rev. A 50, 2138 – Published 1 September 1994</p>
<p>In <em>n2v</em>, we would can request the method in the following way.
Let’s assume we want the exchange-correlation potential of a Neon Atom.</p>
<p>The algorithm will need an initial potential components to guide the inversion procedure. It is common to use the “Fermi Amaldi” (FA) Potential.
Let us now use all of the previous information to perform the desired inversions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Ne</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">geometry</span><span class="p">(</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">0 1</span>
<span class="sd">Ne 0.0 0.0 0.0</span>
<span class="sd">noreorient</span>
<span class="sd">nocom</span>
<span class="sd">units bohr</span>
<span class="sd">symmetry c1</span>
<span class="sd">&quot;&quot;&quot;</span> <span class="p">)</span>


<span class="c1">#n2v is driven by psi4&#39;s reference option. Make sure you set it accordingly.</span>
<span class="n">psi4</span><span class="o">.</span><span class="n">set_options</span><span class="p">({</span><span class="s2">&quot;reference&quot;</span> <span class="p">:</span> <span class="s2">&quot;rhf&quot;</span><span class="p">})</span>

<span class="c1">#Perform a calculation for a target density.</span>
<span class="c1">#Remember that for post scf calculations, Psi4 does not update the density.</span>
<span class="c1">#Thus make sure you obtain something like a dipole in order to do so.</span>
<span class="n">e</span><span class="p">,</span> <span class="n">wfn_ne</span> <span class="o">=</span> <span class="n">psi4</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="s2">&quot;ccsd/cc-pcvqz&quot;</span><span class="p">,</span> <span class="n">return_wfn</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">properties</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;dipole&quot;</span><span class="p">],</span> <span class="n">molecule</span><span class="o">=</span><span class="n">Ne</span><span class="p">)</span>

<span class="c1">#Define inverter objects for each molcule. Simply use the wnf object from psi4 as an argument.</span>
<span class="n">ine</span> <span class="o">=</span> <span class="n">n2v</span><span class="o">.</span><span class="n">Inverter</span><span class="p">(</span><span class="n">wfn_ne</span><span class="p">)</span>

<span class="c1"># Invert the density</span>
  <span class="n">ine</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="s2">&quot;zmp&quot;</span><span class="p">,</span> <span class="n">opt_max_iter</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">opt_tol</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">zmp_mixing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
             <span class="n">lambda_list</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">40</span><span class="p">],</span> <span class="n">guide_potential_components</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fermi_amaldi&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p>If we want to visualize the potential, we need to compute the potential according to:</p>
<div class="math notranslate nohighlight">
\[v_{xc}(r) = v_c(r) - (1-1/N) \cdot v_{FA}(r)\]</div>
</div>


        </div>
      </div>

      <div id="side-menu-container">

        <div id="search" role="search">
        <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
            <input type="text" name="q" placeholder="Search..." />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>
</div>

        <div id="side-menu" role="navigation">

          
  
    
  
  
    <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html"><strong>Installation</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../first_steps.html"><strong>First Steps</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="../on_the_grid.html"><strong>On the Grid</strong></a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../invert.html"><strong>Inverting A Density</strong></a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="direct.html">Direct</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ZMP</a></li>
<li class="toctree-l2"><a class="reference internal" href="wu_yang.html">Wu Yang</a></li>
<li class="toctree-l2"><a class="reference internal" href="ou_carter.html">Ou and Carter</a></li>
<li class="toctree-l2"><a class="reference internal" href="pdeco.html">PDE Constrained Optimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="mrks.html">Modified Ryabinkin-Kohut-Staroverov</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api.html"><strong>API Documentation</strong></a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api.html#module-n2v">n2v Package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../api.html#classes">Classes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../api.html#class-inheritance-diagram">Class Inheritance Diagram</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  


        </div>

        

      </div>

    </div>

<footer>
    <div id="footer-info">
        <ul id="build-details">
            
                <li class="footer-element">
                    
                        <a href="../_sources/invert/zmp.rst.txt" rel="nofollow"> source</a>
                    
                </li>
            

            

            
        </ul>

        
            <div id="copyright">
                &copy; 2020, Wasserman Group.
            </div>
        

        <div id="credit">
            created with <a href="http://sphinx-doc.org/">Sphinx</a> and <a href="https://github.com/Autophagy/insegel">Insegel</a>

        </div>
    </div>

    <a id="menu-toggle" class="fa fa-bars" aria-hidden="true"></a>

    <script type="text/javascript">
      $("#menu-toggle").click(function() {
        $("#menu-toggle").toggleClass("toggled");
        $("#side-menu-container").slideToggle(300);
      });
    </script>

</footer> 

</div>

</body>
</html>